<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>FortWallet Kit - Dev Testing</title>

  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 50%, #16213e 100%);
      color: white;
      font-family: 'SF Pro Display', 'Inter', 'Segoe UI', sans-serif;
      min-height: 100vh;
    }

    header {
      background: rgba(15, 15, 30, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(139, 92, 246, 0.2);
      width: 100%;
      display: flex;
      border-bottom: solid 1px rgba(139, 92, 246, 0.3);
      padding: 1rem 2rem;
      align-items: center;
      justify-content: space-between;
    }

    main {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-width: 800px;
      margin: 0 auto;
    }

    input, textarea {
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 1rem;
      color: white;
      backdrop-filter: blur(10px);
    }

    button {
      padding: 1rem 2rem;
      background: rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.4);
      border-radius: 1rem;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    button:hover {
      background: rgba(139, 92, 246, 0.3);
      transform: translateY(-2px);
    }

    label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
    }

    pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 1rem;
      border-radius: 1rem;
      border: 1px solid rgba(139, 92, 246, 0.2);
      color: #a3a3a3;
    }
  </style>
</head>
<body>

<header>
  <div id='buttonWrapper'></div>
  <div>
    <button id='externalConnect'>Connect</button>
    <button id='externalDisconnect'>Disconnect</button>
  </div>
</header>

<main>
  <label for='publicKey'>Public key</label>
  <br>
  <input placeholder='Use the connect button to fetch the public key' id='publicKey' type='text'>
  <br>
  <label for='xdrTextArea'>XDR to sign</label>
  <br>
  <textarea rows='10' id='xdrTextArea'></textarea>
  <br>
  <button id='signButton'>Sign</button>
  <br>
  <pre id='signedXdr'></pre>
</main>

<br><br>
<button id='externalButton'>Connect with external button</button>
<br><br>
<div>
  <button id='createButton'>Create a button on the header</button>
  <button id='removeButton'>Remove the button from the header</button>
</div>
<br><br>

<script type='module'>
  import { Buffer } from 'buffer';
  window.Buffer = Buffer;
  window.global = window;
</script>

<script type='module'>
  import {
    StellarWalletsKit,
    WalletNetwork,
    allowAllModules,
    XBULL_ID
  } from './build/index.mjs';
  import { WalletConnectModule, WalletConnectAllowedMethods } from './build/modules/walletconnect.module.mjs'
  import { LedgerModule } from './build/modules/ledger.module.mjs'
  import { TrezorModule } from './build/modules/trezor.module.mjs';

  const kit = new StellarWalletsKit({
    network: WalletNetwork.TESTNET,
    modules: [
      ...allowAllModules({ filterBy: module => module.productId === XBULL_ID }),
      new LedgerModule(),
      new TrezorModule({
        appUrl: 'http://localhost:5173',
        email: 'test@localhost.com'
      }),
      new WalletConnectModule({
        url: 'https://stellarwalletskit.dev/',
        projectId: '4e0b84f6ba6bedf7c7f041d919a9f039',
        method: WalletConnectAllowedMethods.SIGN,
        description: `This is a development ID, DO NOT sign transactions that come from this request if you are not a developer testing.`,
        name: 'FortWallet Kit',
        icons: [],
        network: WalletNetwork.TESTNET,
      }),
    ],
  });

  function createDefaultButton() {
    kit.createButton({
      container: document.querySelector('#buttonWrapper'),
      onConnect: ({ address }) => {
        console.log('Address requested: ', address);
        document.querySelector('#publicKey').setAttribute('value', address);
      },
      onDisconnect: () => console.log('Disconnected from the button'),
      buttonText: 'Connect',
      horizonUrl: 'https://horizon.stellar.org/'
    })
  }

  createDefaultButton();

  document.querySelector('#signButton').addEventListener('click', async function(e) {
    const inputElement = document.querySelector('#xdrTextArea');
    console.log('XDR to sign:', inputElement.value);

    const data = await kit.signTransaction(inputElement.value, {
      networkPassphrase: WalletNetwork.TESTNET,
      address: document.querySelector('#publicKey').value,
    });

    document.querySelector('#signedXdr').textContent = JSON.stringify(data, null, 2);
  })

  document.querySelector('#externalButton').addEventListener('click', function(e) {
    kit.openModal({
      onWalletSelected: onWalletSelected => {
        console.log({ onWalletSelected });
      },
      onClosed: onClosed => {
        console.error({ onClosed });
      },
      modalTitle: 'This is a different tittle',
      notAvailableText: 'Nope!'
    });
  });

  document.querySelector('#createButton').addEventListener('click', function(e) {
    createDefaultButton();
  });

  document.querySelector('#removeButton').addEventListener('click', function(e) {
    kit.removeButton();
  });

  kit.assignButtons({
    connectEl: '#externalConnect',
    disconnectEl: '#externalDisconnect',
    onConnect: ({ address }) => {
      console.log('Address requested: ', address);
      document.querySelector('#publicKey').setAttribute('value', address);
    },
    onDisconnect: () => console.log('Disconnected from the button'),
  })
</script>
</body>
</html>
